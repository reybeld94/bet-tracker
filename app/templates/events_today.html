{% extends "base.html" %}
{% block title %}Partidos del dia â€” Bet Tracker{% endblock %}

{% block content %}
<div class="page-header">
  <h1>Partidos del dia</h1>
  <p class="subtitle">{{ start_day.strftime('%Y-%m-%d') }} (timezone local)</p>
</div>

<div class="breadcrumb">
  <a href="/">Dashboard</a>
  <span class="sep">/</span>
  <span>Partidos</span>
</div>

<!-- Filters -->
<div class="card mb-3" style="max-width:700px;">
  <form method="get" action="/events/today">
    <div class="form-row">
      <div class="form-group">
        <label>Sport</label>
        <select name="sport">
          <option value="">Todos</option>
          {% for s in sports %}
            <option value="{{ s }}" {% if selected_sport == s %}selected{% endif %}>{{ s }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label>League</label>
        <select name="league">
          <option value="">Todas</option>
          {% for l in leagues %}
            <option value="{{ l }}" {% if selected_league == l %}selected{% endif %}>{{ l }}</option>
          {% endfor %}
        </select>
      </div>
    </div>
    <div class="actions-row mt-1">
      <button type="submit" class="btn btn-primary btn-sm">Filtrar</button>
      <a href="/events/new" class="btn btn-outline btn-sm">Crear Event manual</a>
    </div>
  </form>
</div>

<!-- Games List -->
<div class="card">
  <div class="card-header">
    <h3>Juegos</h3>
    <span class="badge badge-draft">{{ events|length }}</span>
  </div>
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Evento</th>
          <th>Hora</th>
          <th>Status</th>
          <th style="text-align:right;">Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for e in events %}
        <tr>
          <td>
            <div class="flex items-center gap-1 mb-1">
              <span class="league-badge {{ e.league|lower if e.league else '' }}">
                {% set ll = league_logo_url(e.league) if e.league else '' %}
                {% if ll %}<img src="{{ ll }}" alt="" />{% endif %}
                {{ e.league or e.sport }}
              </span>
            </div>
            <div class="matchup">
              {% set home_logo = team_logo_url(e.home_team) %}
              {% set away_logo = team_logo_url(e.away_team) %}
              {% if home_logo %}
                <img src="{{ home_logo }}" alt="" class="team-logo sm" />
              {% endif %}
              <span class="team-name">{{ e.home_team }}</span>
              <span class="vs-divider">vs</span>
              {% if away_logo %}
                <img src="{{ away_logo }}" alt="" class="team-logo sm" />
              {% endif %}
              <span class="team-name">{{ e.away_team }}</span>
            </div>
          </td>
          <td>
            {% if e.start_time %}
              <span class="font-bold">{{ e.start_time.strftime('%H:%M') }}</span>
            {% else %}
              <span class="text-muted">-</span>
            {% endif %}
          </td>
          <td>
            <span class="badge badge-{% if e.status == 'FINAL' %}bet{% elif e.status == 'IN_PROGRESS' %}lean{% elif e.status == 'SCHEDULED' %}approved{% else %}draft{% endif %}">
              {{ e.status }}
            </span>
          </td>
          <td style="text-align:right;">
            <div class="actions-row" style="justify-content:flex-end;">
              <a href="/events/{{ e.id }}" class="btn btn-outline btn-sm">Detalle</a>
              <a href="/picks/new?event_id={{ e.id }}" class="btn btn-secondary btn-sm">Pick</a>
            </div>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="4" class="table-empty">No hay eventos para hoy con esos filtros.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
